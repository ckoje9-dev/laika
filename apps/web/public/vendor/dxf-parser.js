"use strict";var DxfParser=(()=>{var be=Object.create;var F=Object.defineProperty;var ue=Object.getOwnPropertyDescriptor;var pe=Object.getOwnPropertyNames;var me=Object.getPrototypeOf,ce=Object.prototype.hasOwnProperty;var fe=(r,a,e)=>a in r?F(r,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[a]=e;var de=(r,a)=>()=>(a||r((a={exports:{}}).exports,a),a.exports),xe=(r,a)=>{for(var e in a)F(r,e,{get:a[e],enumerable:!0})},ne=(r,a,e,t)=>{if(a&&typeof a=="object"||typeof a=="function")for(let u of pe(a))!ce.call(r,u)&&u!==e&&F(r,u,{get:()=>a[u],enumerable:!(t=ue(a,u))||t.enumerable});return r};var ye=(r,a,e)=>(e=r!=null?be(me(r)):{},ne(a||!r||!r.__esModule?F(e,"default",{value:r,enumerable:!0}):e,r)),ke=r=>ne(F({},"__esModule",{value:!0}),r);var b=(r,a,e)=>fe(r,typeof a!="symbol"?a+"":a,e);var se=de((ie,te)=>{(function(r,a){"use strict";typeof define=="function"&&define.amd?define(a):typeof te=="object"&&te.exports?te.exports=a():r.log=a()})(ie,function(){"use strict";var r=function(){},a="undefined",e=typeof window!==a&&typeof window.navigator!==a&&/Trident\/|MSIE /.test(window.navigator.userAgent),t=["trace","debug","info","warn","error"];function u(f,k){var x=f[k];if(typeof x.bind=="function")return x.bind(f);try{return Function.prototype.bind.call(x,f)}catch(d){return function(){return Function.prototype.apply.apply(x,[f,arguments])}}}function o(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function y(f){return f==="debug"&&(f="log"),typeof console===a?!1:f==="trace"&&e?o:console[f]!==void 0?u(console,f):console.log!==void 0?u(console,"log"):r}function n(f,k){for(var x=0;x<t.length;x++){var d=t[x];this[d]=x<f?r:this.methodFactory(d,f,k)}this.log=this.debug}function v(f,k,x){return function(){typeof console!==a&&(n.call(this,k,x),this[f].apply(this,arguments))}}function T(f,k,x){return y(f)||v.apply(this,arguments)}function Q(f,k,x){var d=this,A,P="loglevel";typeof f=="string"?P+=":"+f:typeof f=="symbol"&&(P=void 0);function g(i){var p=(t[i]||"silent").toUpperCase();if(!(typeof window===a||!P)){try{window.localStorage[P]=p;return}catch(h){}try{window.document.cookie=encodeURIComponent(P)+"="+p+";"}catch(h){}}}function G(){var i;if(!(typeof window===a||!P)){try{i=window.localStorage[P]}catch(D){}if(typeof i===a)try{var p=window.document.cookie,h=p.indexOf(encodeURIComponent(P)+"=");h!==-1&&(i=/^([^;]+)/.exec(p.slice(h))[1])}catch(D){}return d.levels[i]===void 0&&(i=void 0),i}}d.name=f,d.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},d.methodFactory=x||T,d.getLevel=function(){return A},d.setLevel=function(i,p){if(typeof i=="string"&&d.levels[i.toUpperCase()]!==void 0&&(i=d.levels[i.toUpperCase()]),typeof i=="number"&&i>=0&&i<=d.levels.SILENT){if(A=i,p!==!1&&g(i),n.call(d,i,f),typeof console===a&&i<d.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+i},d.setDefaultLevel=function(i){G()||d.setLevel(i,!1)},d.enableAll=function(i){d.setLevel(d.levels.TRACE,i)},d.disableAll=function(i){d.setLevel(d.levels.SILENT,i)};var l=G();l==null&&(l=k==null?"WARN":k),d.setLevel(l,!1)}var E=new Q,C={};E.getLogger=function(k){if(typeof k!="symbol"&&typeof k!="string"||k==="")throw new TypeError("You must supply a name when creating a logger.");var x=C[k];return x||(x=C[k]=new Q(k,E.getLevel(),E.methodFactory)),x};var $=typeof window!==a?window.log:void 0;return E.noConflict=function(){return typeof window!==a&&window.log===E&&(window.log=$),E},E.getLoggers=function(){return C},E.default=E,E})});var Le={};xe(Le,{DxfParser:()=>S,default:()=>S});var O=class{constructor(a){b(this,"_pointer",0);b(this,"_eof",!1);b(this,"lastReadGroup");b(this,"_data");this._data=a}next(){if(!this.hasNext())throw this._eof?new Error("Cannot call 'next' after EOF group has been read"):new Error("Unexpected end of input: EOF group not read before end of file. Ended on code "+this._data[this._pointer]);let a={code:parseInt(this._data[this._pointer])};return this._pointer++,a.value=re(a.code,this._data[this._pointer].trim()),this._pointer++,a.code===0&&a.value==="EOF"&&(this._eof=!0),this.lastReadGroup=a,a}peek(){if(!this.hasNext())throw this._eof?new Error("Cannot call 'next' after EOF group has been read"):new Error("Unexpected end of input: EOF group not read before end of file. Ended on code "+this._data[this._pointer]);let a={code:parseInt(this._data[this._pointer])};return a.value=re(a.code,this._data[this._pointer+1].trim()),a}rewind(a=1){this._pointer=this._pointer-a*2}hasNext(){return!(this._eof||this._pointer>this._data.length-2)}isEOF(){return this._eof}};function re(r,a){return r<=9?a:r>=10&&r<=59?parseFloat(a):r>=60&&r<=99?parseInt(a):r>=100&&r<=109?a:r>=110&&r<=149?parseFloat(a):r>=160&&r<=179?parseInt(a):r>=210&&r<=239?parseFloat(a):r>=270&&r<=289?parseInt(a):r>=290&&r<=299?Ie(a):r>=300&&r<=369?a:r>=370&&r<=389?parseInt(a):r>=390&&r<=399?a:r>=400&&r<=409?parseInt(a):r>=410&&r<=419?a:r>=420&&r<=429?parseInt(a):r>=430&&r<=439?a:r>=440&&r<=459?parseInt(a):r>=460&&r<=469?parseFloat(a):r>=470&&r<=481||r===999||r>=1e3&&r<=1009?a:r>=1010&&r<=1059?parseFloat(a):r>=1060&&r<=1071?parseInt(a):(console.log("WARNING: Group code does not have a defined type: %j",{code:r,value:a}),a)}function Ie(r){if(r==="0")return!1;if(r==="1")return!0;throw TypeError("String '"+r+"' cannot be cast to Boolean type")}var ee=[0,16711680,16776960,65280,65535,255,16711935,16777215,8421504,12632256,16711680,16744319,13369344,13395558,10027008,10046540,8323072,8339263,4980736,4990502,16727808,16752511,13382400,13401958,10036736,10051404,8331008,8343359,4985600,4992806,16744192,16760703,13395456,13408614,10046464,10056268,8339200,8347455,4990464,4995366,16760576,16768895,13408512,13415014,10056192,10061132,8347392,8351551,4995328,4997670,16776960,16777087,13421568,13421670,10000384,10000460,8355584,8355647,5000192,5000230,12582656,14679935,10079232,11717734,7510016,8755276,6258432,7307071,3755008,4344870,8388352,12582783,6736896,10079334,5019648,7510092,4161280,6258495,2509824,3755046,4194048,10485631,3394560,8375398,2529280,6264908,2064128,5209919,1264640,3099686,65280,8388479,52224,6736998,38912,5019724,32512,4161343,19456,2509862,65343,8388511,52275,6737023,38950,5019743,32543,4161359,19475,2509871,65407,8388543,52326,6737049,38988,5019762,32575,4161375,19494,2509881,65471,8388575,52377,6737074,39026,5019781,32607,4161391,19513,2509890,65535,8388607,52428,6737100,39064,5019800,32639,4161407,19532,2509900,49151,8380415,39372,6730444,29336,5014936,24447,4157311,14668,2507340,32767,8372223,26316,6724044,19608,5010072,16255,4153215,9804,2505036,16383,8364031,13260,6717388,9880,5005208,8063,4149119,4940,2502476,255,8355839,204,6710988,152,5000344,127,4145023,76,2500172,4129023,10452991,3342540,8349388,2490520,6245528,2031743,5193599,1245260,3089996,8323327,12550143,6684876,10053324,4980888,7490712,4128895,6242175,2490444,3745356,12517631,14647295,10027212,11691724,7471256,8735896,6226047,7290751,3735628,4335180,16711935,16744447,13369548,13395660,9961624,9981080,8323199,8339327,4980812,4990540,16711871,16744415,13369497,13395634,9961586,9981061,8323167,8339311,4980793,4990530,16711807,16744383,13369446,13395609,9961548,9981042,8323135,8339295,4980774,4990521,16711743,16744351,13369395,13395583,9961510,9981023,8323103,8339279,4980755,4990511,3355443,5987163,8684676,11382189,14079702,16777215];function he(r){return ee[r]}function s(r){let a={};r.rewind();let e=r.next(),t=e.code;if(a.x=e.value,t+=10,e=r.next(),e.code!=t)throw new Error("Expected code for point value to be "+t+" but got "+e.code+".");return a.y=e.value,t+=10,e=r.next(),e.code!=t?(r.rewind(),a):(a.z=e.value,a)}function oe(r,a){r.rewind();let e=[];for(let t=0;t<16;t++){let u=r.next();if(u.code!==a)throw new Error("Expected code for matrix value to be "+a+" but got "+u.code+".");e.push(u.value)}return e}function c(r,a,e){switch(a.code){case 0:r.type=a.value;break;case 5:r.handle=a.value;break;case 6:r.lineType=a.value;break;case 8:r.layer=a.value;break;case 48:r.lineTypeScale=a.value;break;case 60:r.visible=a.value===0;break;case 62:r.colorIndex=a.value,r.color=he(Math.abs(a.value));break;case 67:r.inPaperSpace=a.value!==0;break;case 100:break;case 101:for(;a.code!=0;)a=e.next();e.rewind();break;case 330:r.ownerHandle=a.value;break;case 347:r.materialObjectHandle=a.value;break;case 370:r.lineweight=a.value;break;case 420:r.color=a.value;break;case 1e3:r.extendedData=r.extendedData||{},r.extendedData.customStrings=r.extendedData.customStrings||[],r.extendedData.customStrings.push(a.value);break;case 1001:r.extendedData=r.extendedData||{},r.extendedData.applicationName=a.value;break;default:return!1}return!0}var N=class{constructor(){b(this,"ForEntityName","3DFACE")}parseEntity(a,e){let t={type:e.value,vertices:[]};for(e=a.next();!a.isEOF()&&e.code!==0;){switch(e.code){case 70:t.shape=(e.value&1)===1,t.hasContinuousLinetypePattern=(e.value&128)===128;break;case 10:t.vertices=ge(a,e),e=a.lastReadGroup;break;default:c(t,e,a);break}e=a.next()}return t}};function ge(r,a){var e=[],t=!1,u=!1,o=4;for(let n=0;n<=o;n++){for(var y={};!r.isEOF()&&!(a.code===0||u);){switch(a.code){case 10:case 11:case 12:case 13:if(t){u=!0;continue}y.x=a.value,t=!0;break;case 20:case 21:case 22:case 23:y.y=a.value;break;case 30:case 31:case 32:case 33:y.z=a.value;break;default:return e}a=r.next()}e.push(y),t=!1,u=!1}return r.rewind(),e}var R=class{constructor(){b(this,"ForEntityName","ARC")}parseEntity(a,e){let t={type:e.value};for(e=a.next();!a.isEOF()&&e.code!==0;){switch(e.code){case 10:t.center=s(a);break;case 40:t.radius=e.value;break;case 50:t.startAngle=Math.PI/180*e.value;break;case 51:t.endAngle=Math.PI/180*e.value,t.angleLength=t.endAngle-t.startAngle;break;case 210:t.extrusionDirectionX=e.value;break;case 220:t.extrusionDirectionY=e.value;break;case 230:t.extrusionDirectionZ=e.value;break;default:c(t,e,a);break}e=a.next()}return t}};var V=class{constructor(){b(this,"ForEntityName","ATTDEF")}parseEntity(a,e){var t={type:e.value,scale:1,textStyle:"STANDARD"};for(e=a.next();!a.isEOF()&&e.code!==0;){switch(e.code){case 1:t.text=e.value;break;case 2:t.tag=e.value;break;case 3:t.prompt=e.value;break;case 7:t.textStyle=e.value;break;case 10:t.startPoint=s(a);break;case 11:t.endPoint=s(a);break;case 39:t.thickness=e.value;break;case 40:t.textHeight=e.value;break;case 41:t.scale=e.value;break;case 50:t.rotation=e.value;break;case 51:t.obliqueAngle=e.value;break;case 70:t.invisible=!!(e.value&1),t.constant=!!(e.value&2),t.verificationRequired=!!(e.value&4),t.preset=!!(e.value&8);break;case 71:t.backwards=!!(e.value&2),t.mirrored=!!(e.value&4);break;case 72:t.horizontalJustification=e.value;break;case 73:t.fieldLength=e.value;break;case 74:t.verticalJustification=e.value;break;case 100:break;case 210:t.extrusionDirectionX=e.value;break;case 220:t.extrusionDirectionY=e.value;break;case 230:t.extrusionDirectionZ=e.value;break;default:c(t,e,a);break}e=a.next()}return t}};var H=class{constructor(){b(this,"ForEntityName","CIRCLE")}parseEntity(a,e){let t={type:e.value};for(e=a.next();!a.isEOF()&&e.code!==0;){switch(e.code){case 10:t.center=s(a);break;case 40:t.radius=e.value;break;case 50:t.startAngle=Math.PI/180*e.value;break;case 51:let u=Math.PI/180*e.value;u<t.startAngle?t.angleLength=u+2*Math.PI-t.startAngle:t.angleLength=u-t.startAngle,t.endAngle=u;break;default:c(t,e,a);break}e=a.next()}return t}};var B=class{constructor(){b(this,"ForEntityName","DIMENSION")}parseEntity(a,e){let t={type:e.value};for(e=a.next();!a.isEOF()&&e.code!==0;){switch(e.code){case 2:t.block=e.value;break;case 10:t.anchorPoint=s(a);break;case 11:t.middleOfText=s(a);break;case 12:t.insertionPoint=s(a);break;case 13:t.linearOrAngularPoint1=s(a);break;case 14:t.linearOrAngularPoint2=s(a);break;case 15:t.diameterOrRadiusPoint=s(a);break;case 16:t.arcPoint=s(a);break;case 70:t.dimensionType=e.value;break;case 71:t.attachmentPoint=e.value;break;case 42:t.actualMeasurement=e.value;break;case 1:t.text=e.value;break;case 50:t.angle=e.value;break;default:c(t,e,a);break}e=a.next()}return t}};var M=class{constructor(){b(this,"ForEntityName","MULTILEADER")}parseEntity(a,e){let t={type:e.value};t.contextData={leaders:[]},e=a.next();function u(){for(;!a.isEOF();){switch(e.code){case 0:return;case 340:t.leaderStyleId=e.value;break;case 170:t.leaderLineType=e.value;break;case 91:t.leaderLineColor=e.value;break;case 341:t.leaderLineTypeId=e.value;break;case 171:t.leaderLineWeight=e.value;break;case 41:t.doglegLength=e.value;break;case 290:t.enableLanding=e.value;break;case 291:t.enableDogLeg=e.value;break;case 342:t.arrowHeadId=e.value;break;case 42:t.arrowHeadSize=e.value;break;case 172:t.contentType=e.value;break;case 173:t.textLeftAttachmentType=e.value;break;case 95:t.textLeftAttachmentType=e.value;break;case 174:t.textAngleType=e.value;break;case 175:t.textAlignmentType=e.value;break;case 343:t.textStyleId=e.value;break;case 92:t.textColor=e.value;break;case 292:t.enableFrameText=e.value;break;case 344:t.blockContentId=e.value;break;case 93:t.blockContentColor=e.value;break;case 10:t.blockContentScale=s(a);break;case 43:t.blockContentRotation=e.value;break;case 176:t.blockContentConnectionType=e.value;break;case 293:t.enableAnotationScale=e.value;break;case 94:t.arrowHeadIndex=e.value;break;case 330:t.blockAttributeId=e.value;break;case 177:t.blockAttributeIndex=e.value;break;case 44:t.blockAttributeWidth=e.value;break;case 302:t.blockAttributeTextString=e.value;break;case 294:t.textDirectionNegative=e.value;break;case 178:t.textAlignInIPE=e.value;break;case 179:t.textAttachmentPoint=e.value;break;case 271:t.textAttachmentDirectionMText=e.value;break;case 272:t.textAttachmentDirectionBottom=e.value;break;case 273:t.textAttachmentDirectionTop=e.value;break;case 300:o();break;default:c(t,e,a);break}e=a.next()}}function o(){for(;!a.isEOF();){switch(e.code){case 40:t.contextData.contentScale=e.value;break;case 10:t.contextData.contentBasePosition=s(a);break;case 145:t.contextData.landingGap=e.value;break;case 290:t.contextData.hasMText=e.value;break;case 304:t.contextData.defaultTextContents=e.value;break;case 11:t.contextData.textNormalDirection=s(a);break;case 12:t.contextData.textLocation=s(a);break;case 13:t.contextData.textDirection=s(a);break;case 140:t.contextData.arrowHeadSize=e.value;break;case 41:t.contextData.textHeight=e.value;break;case 42:t.contextData.textRotation=e.value;break;case 43:t.contextData.textWidth=e.value;break;case 44:t.contextData.textHeight=e.value;break;case 45:t.contextData.textLineSpacingFactor=e.value;break;case 90:t.contextData.textColor=e.value;break;case 170:t.contextData.textLineSpacingStyle=e.value;break;case 171:t.contextData.textAttachment=e.value;break;case 172:t.contextData.textFlowDirection=e.value;break;case 141:t.contextData.textBackgroundScaleFactor=e.value;break;case 92:t.contextData.textBackgroundTransparency=e.value;break;case 291:t.contextData.textBackgroundColorOn=e.value;break;case 292:t.contextData.textBackgroundFillOn=e.value;break;case 293:t.contextData.textUseAutoHeight=e.value;break;case 173:t.contextData.textColumnType=e.value;break;case 142:t.contextData.textColumnWidth=e.value;break;case 143:t.contextData.textColumnGutterWidth=e.value;break;case 144:t.contextData.textColumnHeight=e.value;break;case 295:t.contextData.textUseWordBreak=e.value;break;case 296:t.contextData.hasBlock=e.value;break;case 341:t.contextData.blockContentId=e.value;break;case 14:t.contextData.blockContentNormalDirection=s(a);break;case 15:t.contextData.blockContentPosition=s(a);break;case 16:t.contextData.blockContentScale=e.value;break;case 46:t.contextData.blockContentRotation=e.value;break;case 93:t.contextData.blockContentColor=e.value;break;case 47:t.contextData.blockTransformationMatrix=oe(a,47);break;case 110:t.contextData.planeOriginPoint=s(a);break;case 111:t.contextData.planeXAxisDirection=s(a);break;case 112:t.contextData.planeYAxisDirection=s(a);break;case 297:t.contextData.planeNormalReversed=e.value;break;case 301:return;case 302:y();break;default:break}e=a.next()}}function y(){let v={leaderLines:[]};for(t.contextData.leaders.push(v);!a.isEOF();){switch(e.code){case 290:v.hasSetLastLeaderLinePoint=e.value;break;case 291:v.hasSetDoglegVector=e.value;break;case 10:v.lastLeaderLinePoint=s(a);break;case 11:v.doglegVector=s(a);break;case 90:v.leaderBranchIndex=e.value;break;case 40:v.doglegLength=e.value;break;case 303:return;case 304:n();break;default:break}e=a.next()}}function n(){let v=t.contextData.leaders[t.contextData.leaders.length-1],T={vertices:[[]]};for(v.leaderLines.push(T);!a.isEOF();){switch(e.code){case 10:T.vertices[0].push(s(a));break;case 305:return;default:break}e=a.next()}}return u(),t}};var _=class{constructor(){b(this,"ForEntityName","ELLIPSE")}parseEntity(a,e){let t={type:e.value};for(e=a.next();!a.isEOF()&&e.code!==0;){switch(e.code){case 10:t.center=s(a);break;case 11:t.majorAxisEndPoint=s(a);break;case 40:t.axisRatio=e.value;break;case 41:t.startAngle=e.value;break;case 42:t.endAngle=e.value;break;case 2:t.name=e.value;break;default:c(t,e,a);break}e=a.next()}return t}};var W=class{constructor(){b(this,"ForEntityName","INSERT")}parseEntity(a,e){let t={type:e.value};for(e=a.next();!a.isEOF()&&e.code!==0;){switch(e.code){case 2:t.name=e.value;break;case 41:t.xScale=e.value;break;case 42:t.yScale=e.value;break;case 43:t.zScale=e.value;break;case 10:t.position=s(a);break;case 50:t.rotation=e.value;break;case 70:t.columnCount=e.value;break;case 71:t.rowCount=e.value;break;case 44:t.columnSpacing=e.value;break;case 45:t.rowSpacing=e.value;break;case 210:t.extrusionDirection=s(a);break;default:c(t,e,a);break}e=a.next()}return t}};var Y=class{constructor(){b(this,"ForEntityName","LINE")}parseEntity(a,e){let t={type:e.value,vertices:[]};for(e=a.next();!a.isEOF()&&e.code!==0;){switch(e.code){case 10:t.vertices.unshift(s(a));break;case 11:t.vertices.push(s(a));break;case 210:t.extrusionDirection=s(a);break;case 100:break;default:c(t,e,a);break}e=a.next()}return t}};var U=class{constructor(){b(this,"ForEntityName","LWPOLYLINE")}parseEntity(a,e){let t={type:e.value,vertices:[]},u=0;for(e=a.next();!a.isEOF()&&e.code!==0;){switch(e.code){case 38:t.elevation=e.value;break;case 39:t.depth=e.value;break;case 70:t.shape=(e.value&1)===1,t.hasContinuousLinetypePattern=(e.value&128)===128;break;case 90:u=e.value;break;case 10:t.vertices=ve(u,a);break;case 43:e.value!==0&&(t.width=e.value);break;case 210:t.extrusionDirectionX=e.value;break;case 220:t.extrusionDirectionY=e.value;break;case 230:t.extrusionDirectionZ=e.value;break;default:c(t,e,a);break}e=a.next()}return t}};function ve(r,a){if(!r||r<=0)throw Error("n must be greater than 0 verticies");let e=[],t=!1,u=!1,o=a.lastReadGroup;for(let y=0;y<r;y++){let n={};for(;!a.isEOF()&&!(o.code===0||u);){switch(o.code){case 10:if(t){u=!0;continue}n.x=o.value,t=!0;break;case 20:n.y=o.value;break;case 30:n.z=o.value;break;case 40:n.startWidth=o.value;break;case 41:n.endWidth=o.value;break;case 42:o.value!=0&&(n.bulge=o.value);break;default:return a.rewind(),t&&e.push(n),a.rewind(),e}o=a.next()}e.push(n),t=!1,u=!1}return a.rewind(),e}var z=class{constructor(){b(this,"ForEntityName","MTEXT")}parseEntity(a,e){let t={type:e.value};for(e=a.next();!a.isEOF()&&e.code!==0;){switch(e.code){case 3:t.text?t.text+=e.value:t.text=e.value;break;case 1:t.text?t.text+=e.value:t.text=e.value;break;case 10:t.position=s(a);break;case 11:t.directionVector=s(a);break;case 40:t.height=e.value;break;case 41:t.width=e.value;break;case 50:t.rotation=e.value;break;case 71:t.attachmentPoint=e.value;break;case 72:t.drawingDirection=e.value;break;default:c(t,e,a);break}e=a.next()}return t}};var X=class{constructor(){b(this,"ForEntityName","POINT")}parseEntity(a,e){let u={type:e.value};for(e=a.next();!a.isEOF()&&e.code!==0;){switch(e.code){case 10:u.position=s(a);break;case 39:u.thickness=e.value;break;case 210:u.extrusionDirection=s(a);break;case 100:break;default:c(u,e,a);break}e=a.next()}return u}};var K=class{constructor(){b(this,"ForEntityName","VERTEX")}parseEntity(a,e){var t={type:e.value};for(e=a.next();!a.isEOF()&&e.code!==0;){switch(e.code){case 10:t.x=e.value;break;case 20:t.y=e.value;break;case 30:t.z=e.value;break;case 40:break;case 41:break;case 42:e.value!=0&&(t.bulge=e.value);break;case 70:t.curveFittingVertex=(e.value&1)!==0,t.curveFitTangent=(e.value&2)!==0,t.splineVertex=(e.value&8)!==0,t.splineControlPoint=(e.value&16)!==0,t.threeDPolylineVertex=(e.value&32)!==0,t.threeDPolylineMesh=(e.value&64)!==0,t.polyfaceMeshVertex=(e.value&128)!==0;break;case 50:break;case 71:t.faceA=e.value;break;case 72:t.faceB=e.value;break;case 73:t.faceC=e.value;break;case 74:t.faceD=e.value;break;default:c(t,e,a);break}e=a.next()}return t}};var Z=class{constructor(){b(this,"ForEntityName","POLYLINE")}parseEntity(a,e){var t={type:e.value,vertices:[]};for(e=a.next();!a.isEOF()&&e.code!==0;){switch(e.code){case 10:break;case 20:break;case 30:break;case 39:t.thickness=e.value;break;case 40:break;case 41:break;case 70:t.shape=(e.value&1)!==0,t.includesCurveFitVertices=(e.value&2)!==0,t.includesSplineFitVertices=(e.value&4)!==0,t.is3dPolyline=(e.value&8)!==0,t.is3dPolygonMesh=(e.value&16)!==0,t.is3dPolygonMeshClosed=(e.value&32)!==0,t.isPolyfaceMesh=(e.value&64)!==0,t.hasContinuousLinetypePattern=(e.value&128)!==0;break;case 71:break;case 72:break;case 73:break;case 74:break;case 75:break;case 210:t.extrusionDirection=s(a);break;default:c(t,e,a);break}e=a.next()}return t.vertices=Ee(a,e),t}};function Ee(r,a){let e=new K,t=[];for(;!r.isEOF();)if(a.code===0){if(a.value==="VERTEX")t.push(e.parseEntity(r,a)),a=r.lastReadGroup;else if(a.value==="SEQEND"){Pe(r,a);break}}return t}function Pe(r,a){let e={type:a.value};for(a=r.next();!r.isEOF()&&a.code!=0;)c(e,a,r),a=r.next();return e}var q=class{constructor(){b(this,"ForEntityName","SOLID")}parseEntity(a,e){let t={type:e.value,points:[]};for(e=a.next();!a.isEOF()&&e.code!==0;){switch(e.code){case 10:t.points[0]=s(a);break;case 11:t.points[1]=s(a);break;case 12:t.points[2]=s(a);break;case 13:t.points[3]=s(a);break;case 210:t.extrusionDirection=s(a);break;default:c(t,e,a);break}e=a.next()}return t}};var J=class{constructor(){b(this,"ForEntityName","SPLINE")}parseEntity(a,e){let t={type:e.value};for(e=a.next();!a.isEOF()&&e.code!==0;){switch(e.code){case 10:t.controlPoints||(t.controlPoints=[]),t.controlPoints.push(s(a));break;case 11:t.fitPoints||(t.fitPoints=[]),t.fitPoints.push(s(a));break;case 12:t.startTangent=s(a);break;case 13:t.endTangent=s(a);break;case 40:t.knotValues||(t.knotValues=[]),t.knotValues.push(e.value);break;case 70:(e.value&1)!=0&&(t.closed=!0),(e.value&2)!=0&&(t.periodic=!0),(e.value&4)!=0&&(t.rational=!0),(e.value&8)!=0&&(t.planar=!0),(e.value&16)!=0&&(t.planar=!0,t.linear=!0);break;case 71:t.degreeOfSplineCurve=e.value;break;case 72:t.numberOfKnots=e.value;break;case 73:t.numberOfControlPoints=e.value;break;case 74:t.numberOfFitPoints=e.value;break;case 210:t.normalVector=s(a);break;default:c(t,e,a);break}e=a.next()}return t}};var j=class{constructor(){b(this,"ForEntityName","TEXT")}parseEntity(a,e){let t={type:e.value};for(e=a.next();!a.isEOF()&&e.code!==0;){switch(e.code){case 10:t.startPoint=s(a);break;case 11:t.endPoint=s(a);break;case 40:t.textHeight=e.value;break;case 41:t.xScale=e.value;break;case 50:t.rotation=e.value;break;case 1:t.text=e.value;break;case 72:t.halign=e.value;break;case 73:t.valign=e.value;break;default:c(t,e,a);break}e=a.next()}return t}};var m=ye(se(),1);m.default.setLevel("error");function De(r){r.registerEntityHandler(N),r.registerEntityHandler(R),r.registerEntityHandler(V),r.registerEntityHandler(H),r.registerEntityHandler(B),r.registerEntityHandler(M),r.registerEntityHandler(_),r.registerEntityHandler(W),r.registerEntityHandler(Y),r.registerEntityHandler(U),r.registerEntityHandler(z),r.registerEntityHandler(X),r.registerEntityHandler(Z),r.registerEntityHandler(q),r.registerEntityHandler(J),r.registerEntityHandler(j)}var S=class{constructor(){b(this,"_entityHandlers",{});De(this)}parse(a){return typeof a=="string"?this._parse(a):(console.error("Cannot read dxf source of type `"+typeof a),null)}registerEntityHandler(a){let e=new a;this._entityHandlers[e.ForEntityName]=e}parseSync(a){return this.parse(a)}parseStream(a){let e="",t=this;return new Promise((u,o)=>{a.on("data",y=>{e+=y}),a.on("end",()=>{try{u(t._parse(e))}catch(y){o(y)}}),a.on("error",y=>{o(y)})})}_parse(a){let e={},t=0,u=a.split(/\r\n|\r|\n/g),o=new O(u);if(!o.hasNext())throw Error("Empty file");let y=this,n;function v(){for(n=o.next();!o.isEOF();)if(n.code===0&&n.value==="SECTION"){if(n=o.next(),n.code!==2){console.error("Unexpected code %s after 0:SECTION",le(n)),n=o.next();continue}n.value==="HEADER"?(m.default.debug("> HEADER"),e.header=T(),m.default.debug("<")):n.value==="BLOCKS"?(m.default.debug("> BLOCKS"),e.blocks=Q(),m.default.debug("<")):n.value==="ENTITIES"?(m.default.debug("> ENTITIES"),e.entities=P(!1),m.default.debug("<")):n.value==="TABLES"?(m.default.debug("> TABLES"),e.tables=C(),m.default.debug("<")):n.value==="EOF"?m.default.debug("EOF"):m.default.warn("Skipping section '%s'",n.value)}else n=o.next()}function T(){let l=null,i=null,p={};for(n=o.next();;){if(w(n,0,"ENDSEC")){l&&(p[l]=i);break}else n.code===9?(l&&(p[l]=i),l=n.value):n.code===10?i={x:n.value}:n.code===20?i.y=n.value:n.code===30?i.z=n.value:i=n.value;n=o.next()}return n=o.next(),p}function Q(){let l={};for(n=o.next();n.value!=="EOF"&&!w(n,0,"ENDSEC");)if(w(n,0,"BLOCK")){m.default.debug("block {");let i=E();m.default.debug("}"),G(i),i.name?l[i.name]=i:m.default.error('block with handle "'+i.handle+'" is missing a name.')}else L(n),n=o.next();return l}function E(){let l={};for(n=o.next();n.value!=="EOF";){switch(n.code){case 1:l.xrefPath=n.value,n=o.next();break;case 2:l.name=n.value,n=o.next();break;case 3:l.name2=n.value,n=o.next();break;case 5:l.handle=n.value,n=o.next();break;case 8:l.layer=n.value,n=o.next();break;case 10:l.position=g(n),n=o.next();break;case 67:l.paperSpace=!!(n.value&&n.value==1),n=o.next();break;case 70:n.value!=0&&(l.type=n.value),n=o.next();break;case 100:n=o.next();break;case 330:l.ownerHandle=n.value,n=o.next();break;case 0:if(n.value=="ENDBLK")break;l.entities=P(!0);break;default:L(n),n=o.next()}if(w(n,0,"ENDBLK")){n=o.next();break}}return l}function C(){let l={};for(n=o.next();n.value!=="EOF"&&!w(n,0,"ENDSEC");)w(n,0,"TABLE")?(n=o.next(),A[n.value]?(m.default.debug(n.value+" Table {"),l[A[n.value].tableName]=f(n),m.default.debug("}")):m.default.debug("Unhandled Table "+n.value)):n=o.next();return n=o.next(),l}let $="ENDTAB";function f(l){let i=A[l.value],p={},h=0;for(n=o.next();!w(n,0,$);)switch(n.code){case 5:p.handle=n.value,n=o.next();break;case 330:p.ownerHandle=n.value,n=o.next();break;case 100:n.value==="AcDbSymbolTable"||L(n),n=o.next();break;case 70:h=n.value,n=o.next();break;case 0:n.value===i.dxfSymbolName?p[i.tableRecordsProperty]=i.parseTableRecords():(L(n),n=o.next());break;default:L(n),n=o.next()}let D=p[i.tableRecordsProperty];if(D){let ae=(()=>{if(D.constructor===Array)return D.length;if(typeof D=="object")return Object.keys(D).length})();h!==ae&&m.default.warn("Parsed "+ae+" "+i.dxfSymbolName+"'s but expected "+h)}return n=o.next(),p}function k(){let l=[],i={};for(m.default.debug("ViewPort {"),n=o.next();!w(n,0,$);)switch(n.code){case 2:i.name=n.value,n=o.next();break;case 10:i.lowerLeftCorner=g(n),n=o.next();break;case 11:i.upperRightCorner=g(n),n=o.next();break;case 12:i.center=g(n),n=o.next();break;case 13:i.snapBasePoint=g(n),n=o.next();break;case 14:i.snapSpacing=g(n),n=o.next();break;case 15:i.gridSpacing=g(n),n=o.next();break;case 16:i.viewDirectionFromTarget=g(n),n=o.next();break;case 17:i.viewTarget=g(n),n=o.next();break;case 42:i.lensLength=n.value,n=o.next();break;case 43:i.frontClippingPlane=n.value,n=o.next();break;case 44:i.backClippingPlane=n.value,n=o.next();break;case 45:i.viewHeight=n.value,n=o.next();break;case 50:i.snapRotationAngle=n.value,n=o.next();break;case 51:i.viewTwistAngle=n.value,n=o.next();break;case 79:i.orthographicType=n.value,n=o.next();break;case 110:i.ucsOrigin=g(n),n=o.next();break;case 111:i.ucsXAxis=g(n),n=o.next();break;case 112:i.ucsYAxis=g(n),n=o.next();break;case 281:i.renderMode=n.value,n=o.next();break;case 282:i.defaultLightingType=n.value,n=o.next();break;case 292:i.defaultLightingOn=n.value,n=o.next();break;case 330:i.ownerHandle=n.value,n=o.next();break;case 63:case 421:case 431:i.ambientColor=n.value,n=o.next();break;case 0:n.value==="VPORT"&&(m.default.debug("}"),l.push(i),m.default.debug("ViewPort {"),i={},n=o.next());break;default:L(n),n=o.next();break}return m.default.debug("}"),l.push(i),l}function x(){let l={},i={},p=0,h;for(m.default.debug("LType {"),n=o.next();!w(n,0,"ENDTAB");)switch(n.code){case 2:i.name=n.value,h=n.value,n=o.next();break;case 3:i.description=n.value,n=o.next();break;case 73:p=n.value,p>0&&(i.pattern=[]),n=o.next();break;case 40:i.patternLength=n.value,n=o.next();break;case 49:i.pattern.push(n.value),n=o.next();break;case 0:m.default.debug("}"),p>0&&p!==i.pattern.length&&m.default.warn("lengths do not match on LTYPE pattern"),l[h]=i,i={},m.default.debug("LType {"),n=o.next();break;default:n=o.next()}return m.default.debug("}"),l[h]=i,l}function d(){let l={},i={},p;for(m.default.debug("Layer {"),n=o.next();!w(n,0,"ENDTAB");)switch(n.code){case 2:i.name=n.value,p=n.value,n=o.next();break;case 62:i.visible=n.value>=0,i.colorIndex=Math.abs(n.value),i.color=we(i.colorIndex),n=o.next();break;case 70:i.frozen=(n.value&1)!=0||(n.value&2)!=0,n=o.next();break;case 420:i.color=Math.abs(n.value),n=o.next();break;case 0:n.value==="LAYER"&&(m.default.debug("}"),l[p]=i,m.default.debug("Layer {"),i={},p=void 0,n=o.next());break;default:L(n),n=o.next();break}return m.default.debug("}"),l[p]=i,l}let A={VPORT:{tableRecordsProperty:"viewPorts",tableName:"viewPort",dxfSymbolName:"VPORT",parseTableRecords:k},LTYPE:{tableRecordsProperty:"lineTypes",tableName:"lineType",dxfSymbolName:"LTYPE",parseTableRecords:x},LAYER:{tableRecordsProperty:"layers",tableName:"layer",dxfSymbolName:"LAYER",parseTableRecords:d}};function P(l){let i=[],p=l?"ENDBLK":"ENDSEC";for(l||(n=o.next());;)if(n.code===0){if(n.value===p)break;let h=y._entityHandlers[n.value];if(h!=null){m.default.debug(n.value+" {");let D=h.parseEntity(o,n);n=o.lastReadGroup,m.default.debug("}"),G(D),i.push(D)}else{m.default.warn("Unhandled entity "+n.value),n=o.next();continue}}else n=o.next();return p=="ENDSEC"&&(n=o.next()),i}function g(l){let i={},p=l.code;if(i.x=l.value,p+=10,l=o.next(),l.code!=p)throw new Error("Expected code for point value to be "+p+" but got "+l.code+".");return i.y=l.value,p+=10,l=o.next(),l.code!=p?(o.rewind(),i):(i.z=l.value,i)}function G(l){if(!l)throw new TypeError("entity cannot be undefined or null");l.handle||(l.handle=t++)}return v(),e}};function w(r,a,e){return r.code===a&&r.value===e}function L(r){m.default.debug("unhandled group "+le(r))}function le(r){return r.code+":"+r.value}function we(r){return ee[r]}return ke(Le);})();
