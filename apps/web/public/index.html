<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LAIKA</title>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script src="/vendor/FontLoader.js"></script>
  <script src="/vendor/TextGeometry.js"></script>
  <script src="/vendor/OrbitControls.js"></script>
  <script src="/vendor/three-dxf.js"></script>
  <script src="/vendor/dxf-parser.js"></script>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <header>
    <div class="nav">
      <div class="brand" id="btnHome">
        <div class="brand-mark">L</div>
        <div>
          <div style="font-size:14px; color: var(--muted);">AI 도면 플랫폼</div>
          <div style="font-size:16px;">LAIKA</div>
        </div>
      </div>
      <div class="tabs">
      <div class="tab" data-tab="convert">DWG-DXF 변환</div>
        <div class="tab" data-tab="analyze">AI 도면 분석</div>
        <div class="tab" data-tab="generate">AI 도면 생성</div>
      </div>
      <div class="nav-actions">
        <div class="badge" id="userBadge">게스트 · 비로그인</div>
        <button class="btn ghost" id="btnSignup">회원가입</button>
        <button class="btn ghost" id="btnLogin">로그인</button>
      </div>
    </div>
  </header>

  <main>
    <section id="home" class="active">
      <div class="hero">
        <div class="pill">LAIKA · Intelligent Drawing Automation</div>
        <h1>DWG/DXF 파이프라인을 한 곳에서.<br />업로드·분석·생성을 모두 자동화하세요.</h1>
        <p>DWG ↔ DXF 변환, AI 기반 도면 분석, 도면 생성까지 하나의 워크플로우로 제공합니다. 업로드만 하면 버전 관리와 파싱, 분석 결과 시각화가 이어집니다.</p>
        <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:10px;">
          <button class="btn primary" data-tab-jump="convert">DWG-DXF 변환 시작</button>
          <button class="btn" data-tab-jump="analyze">AI 도면 분석 보기</button>
          <div class="pill-lock">로그인 시 AI 도면 분석 가능 · 구독 시 AI 도면 생성 활성화</div>
        </div>
      </div>
      <div class="layout" style="margin-top:18px;">
        <div class="card">
          <h3>LAIKA가 하는 일</h3>
          <div class="muted">업로드 → 변환 → 파싱 → 분석 → 생성까지 이어지는 여정을 미리 확인하세요.</div>
          <div style="display:flex; flex-direction:column; gap:12px;">
            <div class="capsule"><span class="pill-success">1</span>DWG ↔ DXF 변환 (odaconverter)</div>
            <div class="capsule"><span class="pill-success">2</span>기본 파싱 (ezdxf) · 엔티티/레이어/블록 DB 적재</div>
            <div class="capsule"><span class="pill-warn">3</span>블록/레이어 역할 지정 · 축선/구조체/도곽 설정</div>
            <div class="capsule"><span class="pill-warn">4</span>AI 분석 실행 · 결과 표/다이아그램 다운로드</div>
            <div class="capsule"><span class="pill-error">5</span>구독 시 AI 도면 생성(Coming soon)</div>
          </div>
        </div>
        <div class="card">
          <h3>접근 권한</h3>
          <div class="muted">페이지별 이용 조건입니다.</div>
          <div style="display:flex; flex-direction:column; gap:10px;">
            <div class="tag"><span class="pill-success">공개</span> DWG-DXF 변환 · 누구나 사용</div>
            <div class="tag"><span class="pill-warn">로그인 필요</span> AI 도면 분석 · 회원만</div>
            <div class="tag"><span class="pill-error">구독 필요</span> AI 도면 생성 · 결제 구독자 전용</div>
          </div>
        </div>
      </div>
    </section>

    <section id="login">
      <div class="hero">
        <div class="pill">로그인</div>
        <h1>다시 만나서 반가워요</h1>
        <p>테스트 계정: admin/admin(관리자, 구독), aaa/aaa(회원), bbb/bbb(회원+구독)</p>
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <span class="capsule">admin / admin · 관리자 · 구독</span>
          <span class="capsule">aaa / aaa · 일반 · 미구독</span>
          <span class="capsule">bbb / bbb · 일반 · 구독</span>
        </div>
      </div>
      <div class="layout">
        <div class="card" style="grid-column: span 2;">
          <h3>로그인 폼</h3>
          <div class="field">
            <label>아이디</label>
            <input class="input" id="loginId" placeholder="아이디" />
          </div>
          <div class="field">
            <label>비밀번호</label>
            <input class="input" id="loginPwd" placeholder="비밀번호" type="password" />
          </div>
          <div class="actions-row">
            <button class="btn primary" id="btnDoLogin">로그인</button>
            <button class="btn" data-tab-jump="signup">회원가입으로 이동</button>
          </div>
        </div>
      </div>
    </section>

    <section id="signup">
      <div class="hero">
        <div class="pill">회원가입</div>
        <h1>새 계정을 만들어보세요</h1>
        <p>회원가입 후 AI 도면 분석을 이용할 수 있습니다. 구독은 로그인 후 "구독하기" 버튼으로 전환하세요.</p>
      </div>
      <div class="layout">
        <div class="card" style="grid-column: span 2;">
          <h3>회원가입 폼</h3>
          <div class="field">
            <label>아이디</label>
            <input class="input" id="signupId" placeholder="아이디" />
          </div>
          <div class="field">
            <label>비밀번호</label>
            <input class="input" id="signupPwd" placeholder="비밀번호" type="password" />
          </div>
          <div class="field">
            <label>비밀번호 확인</label>
            <input class="input" id="signupPwd2" placeholder="비밀번호 확인" type="password" />
          </div>
          <div class="actions-row">
            <button class="btn primary" id="btnDoSignup">가입하기</button>
            <button class="btn" data-tab-jump="login">로그인으로 이동</button>
          </div>
        </div>
      </div>
    </section>

    <section id="convert">
      <div class="hero">
        <div class="pill">STEP 1</div>
        <h1>DWG-DXF 변환기</h1>
        <p>웹에서 바로 DWG ↔ DXF 변환할 수 있습니다.</p>
      </div>
      <div class="layout">
        <div class="card" style="grid-column: span 2;">
          <div class="convert-header">
            <h3>파일 업로드</h3>
            <div class="convert-toggle" id="convertToggle">
              <button class="toggle-btn active" data-mode="dwg2dxf">DWG to DXF</button>
              <button class="toggle-btn" data-mode="dxf2dwg">DXF to DWG</button>
            </div>
          </div>
          <div class="dropzone" id="dropConvert">
            <div class="drop-icon"></div>
            <div style="font-size:17px; font-weight:700;" id="convertDropTitle">파일 선택</div>
            <div class="muted" style="margin-top:6px;" id="convertDropHint">또는 여기로 드롭 (최대 100MB)</div>
            <input type="file" id="inputConvert" accept=".dwg" multiple style="display:none;" />
          </div>
          <div class="file-list" id="convertList" style="display:none;"></div>
          <div class="actions-center">
            <button class="btn primary" id="btnConvertStart" disabled>변환하기 <span class="throbber" aria-hidden="true"></span></button>
            <button class="btn" id="btnConvertDownload" style="display:none;">일괄 다운로드</button>
          </div>
        </div>
      </div>
    </section>

    <section id="analyze">
      <div class="hero">
        <div class="pill">STEP 2</div>
        <h1>AI 도면 분석기</h1>
        <p>AI로 DXF 도면을 분석하세요.</p>
        <div id="analyzeLock" class="pill-lock" style="margin-top:8px;">로그인 시 이용 가능합니다.</div>
      </div>
      <div class="layout">
        <div class="card" style="grid-column: span 2;">
          <h3>파일 업로드</h3>
          <div class="dropzone" id="dropAnalyze">
            <div class="drop-icon"></div>
            <div style="font-size:17px; font-weight:700;">파일 선택</div>
            <div class="muted" style="margin-top:6px;">또는 여기로 드롭 (최대 100MB)</div>
            <input type="file" id="inputAnalyze" accept=".dxf" multiple style="display:none;" />
          </div>
          <div class="file-list" id="analyzeList" style="display:none;"></div>
          <div class="actions-center">
            <button class="btn primary" id="btnParse">파싱하기 <span class="throbber" aria-hidden="true"></span></button>
          </div>
        </div>
      </div>
        <div id="resultSection" class="layout" style="margin-top:16px; display:none;">
          <div class="card" style="grid-column: span 2;">
            <h3>파싱 결과</h3>
            <div class="tab-layout" style="margin-top:8px;">
              <div class="tab-rail" id="resultList"></div>
              <div class="card" style="padding:12px; background: var(--surface-2);">
                <div id="resultView" class="muted">파일을 선택하세요.</div>
              </div>
            </div>
            <div class="actions-row" style="margin-top:12px; justify-content:center;">
              <button class="btn primary" id="btnShowDetail">설정하기</button>
            </div>
          </div>
        </div>
      <div id="detailSection" class="layout" style="margin-top:16px; display:none;">
        <div class="card" style="grid-column: span 2;">
          <h3>세부 설정</h3>
          <div class="muted">템플릿 DXF를 선택하면 자동 지정 후 필요 시 세부 요소를 수정할 수 있습니다.</div>
          <div class="row-select" style="grid-template-columns: 140px 1fr auto; margin-top:10px;">
            <label>템플릿 DXF</label>
            <div class="smart-select compact-select" id="template-file-select" data-select-type="template"></div>
          </div>
          <div class="config-columns">
            <div class="config-card">
              <h4>기본</h4>
              <div class="row-select compact"><label>도곽</label><div class="smart-select compact-select" id="basic-border-block" data-select-type="block"></div></div>
              <div class="row-select compact"><label>치수</label><div class="smart-select compact-select" id="basic-dim-layer" data-select-type="layer"></div></div>
              <div class="row-select compact"><label>심볼</label><div class="smart-select compact-select" id="basic-symbol-layer" data-select-type="layer"></div></div>
              <div class="row-select compact"><label>텍스트</label><div class="smart-select compact-select" id="basic-text-layer" data-select-type="layer"></div></div>
              <div class="row-select compact"><label>축선</label><div class="smart-select compact-select" id="struct-axis-layer" data-select-type="layer"></div></div>
            </div>
            <div class="config-card">
              <h4>구조 요소</h4>
              <div class="row-select compact"><label>콘크리트 기둥</label><div class="smart-select compact-select" id="struct-ccol-layer" data-select-type="layer"></div></div>
              <div class="row-select compact"><label>철골 기둥</label><div class="smart-select compact-select" id="struct-scol-layer" data-select-type="layer"></div></div>
              <div class="row-select compact"><label>콘크리트 벽체/슬라브</label><div class="smart-select compact-select" id="struct-cwall-layer" data-select-type="layer"></div></div>
            </div>
            <div class="config-card">
              <h4>비구조 요소</h4>
              <div class="row-select compact"><label>비내력 벽체</label><div class="smart-select compact-select" id="non-wall-layer" data-select-type="layer"></div></div>
              <div class="row-select compact"><label>문</label><div class="smart-select compact-select" id="non-door-layer" data-select-type="layer"></div></div>
              <div class="row-select compact"><label>창호</label><div class="smart-select compact-select" id="non-window-layer" data-select-type="layer"></div></div>
              <div class="row-select compact"><label>계단/경사로</label><div class="smart-select compact-select" id="non-stair-layer" data-select-type="layer"></div></div>
              <div class="row-select compact"><label>엘리베이터</label><div class="smart-select compact-select" id="non-elevator-layer" data-select-type="layer"></div></div>
              <div class="row-select compact"><label>가구</label><div class="smart-select compact-select" id="non-furniture-layer" data-select-type="layer"></div></div>
              <div class="row-select compact"><label>마감</label><div class="smart-select compact-select" id="non-finish-layer" data-select-type="layer"></div></div>
            </div>
          </div>
          <div class="actions-center">
            <button class="btn primary" id="btnAnalyze">분석하기 <span class="throbber" aria-hidden="true"></span></button>
          </div>
        </div>
      </div>
      <div id="aiResultSection" class="layout" style="margin-top:16px; display:none;">
        <div class="card" style="grid-column: span 2;">
          <h3>AI 분석 결과</h3>
          <div class="tab-layout" style="margin-top:8px;">
            <div class="tab-rail" id="aiBorderList"></div>
            <div class="card" style="padding:12px; background: var(--surface-2);">
              <div id="aiResultView" class="muted">결과가 준비되면 여기에 표시됩니다.</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="generate">
      <div class="hero">
        <div class="pill">STEP 3 · AI 도면 생성</div>
        <h1>AI 도면 생성</h1>
        <p>자연어로 도면을 생성하고 수정하세요.</p>
        <div id="generateLock" class="pill-lock" style="margin-top:8px;">구독 결제 시 활성화됩니다.</div>
      </div>

      <div id="generateContent" class="layout" style="display:none;">
        <!-- 세션 관리 영역 -->
        <div class="card" style="grid-column: span 2;">
          <div class="generate-header">
            <h3>세션</h3>
            <button class="btn ghost" id="btnNewSession">새 세션</button>
          </div>
          <div class="session-list" id="generateSessionList">
            <div class="muted">저장된 세션이 없습니다.</div>
          </div>
        </div>

        <!-- 메인 작업 영역 -->
        <div class="card generate-workspace" style="grid-column: span 2;">
          <div class="generate-split">
            <!-- 좌측: 대화 히스토리 -->
            <div class="generate-history-panel">
              <h4>대화 기록</h4>
              <div class="chat-history" id="generateHistory">
                <div class="muted">새 도면을 생성해보세요.</div>
              </div>
            </div>

            <!-- 우측: 미리보기 -->
            <div class="generate-preview-panel">
              <h4>미리보기</h4>
              <div class="generate-preview" id="generatePreview">
                <div class="muted" style="display:flex; align-items:center; justify-content:center; height:100%;">도면이 생성되면 여기에 표시됩니다.</div>
              </div>
              <div class="version-list" id="generateVersionList"></div>
            </div>
          </div>

          <!-- 프롬프트 입력 -->
          <div class="generate-input-area">
            <textarea class="input generate-prompt" id="generatePrompt" placeholder="예: 7m x 7m 그리드로 4x3 기둥 배치를 생성해줘" rows="2"></textarea>
            <div class="generate-actions">
              <button class="btn primary" id="btnGenerate">생성하기 <span class="throbber" aria-hidden="true"></span></button>
              <button class="btn" id="btnModify">수정하기 <span class="throbber" aria-hidden="true"></span></button>
            </div>
          </div>

          <!-- 다운로드 영역 -->
          <div class="generate-download">
            <button class="btn ghost" id="btnShowSchema">스키마 보기</button>
            <button class="btn" id="btnDownloadDxf">DXF 다운로드</button>
            <button class="btn" id="btnConvertDwg">DWG 변환 <span class="throbber" aria-hidden="true"></span></button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- 모듈화된 JavaScript -->
  <script type="module" src="/js/main.js"></script>
</body>
</html>
